---
title: "Importing STAR templates"
output:
  html_vignette:
    mathjax: null
vignette: >
  %\VignetteIndexEntry{Importing STAR templates}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse=TRUE,
  comment="#>",
  eval=FALSE
)
```

Load package and specify directories:

```{r}
library(gfcmSTAR)
## uploads <- "~/git/gfcm-devops/StockAssessmentResults/uploads/2021"
uploads <- "~/StockAssessmentResults/uploads/2021"
star.dir <- file.path(uploads, "WGSAD_Western_Mediterranean")
prop.file <- file.path(uploads, "properties/WGSAD_Western_Mediterranean.xlsx")
```

Read SharePoint properties:

```{r}
prop <- read.properties(prop.file)
```

Import STAR templates:

```{r}
cluster <- import.many.templates(star.dir, prop=prop)
cbind(sapply(cluster, class))
```

Exclude STAR templates that have errors:

```{r}
cluster.ok <- cluster[sapply(cluster, class) != "try-error"]
cbind(sapply(cluster.ok, class))
```

Check that the `Assessment` fields are unique:

```{r}
peek <- function(star) star$Metadata$Assessment
assessment <- sapply(cluster.ok, peek)
cbind(assessment)
any(duplicated(assessment))
```
