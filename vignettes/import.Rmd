---
title: "Importing STAR templates"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Importing STAR templates}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse=TRUE,
  comment="#>",
  eval=FALSE
)
```

Load package and specify directories:

```{r}
library(gfcmSTAR)
star.dir <- file.path("~/git/gfcm-devops/StockAssessmentResults/uploads",
                      "2021/WGSAD_Western_Mediterranean")
prop.file <- file.path("~/git/gfcm-devops/StockAssessmentResults/uploads",
                       "2021/properties/WGSAD_Western_Mediterranean.xlsx")
```

Read SharePoint properties:

```{r}
prop <- read.properties(prop.file)
```

Import STAR templates:

```{r}
cluster <- import.dir(star.dir, prop=prop)
cbind(sapply(cluster, class))
```

Exclude STAR templates that have errors:

```{r}
cluster.ok <- cluster[sapply(cluster, class) != "try-error"]
cbind(sapply(cluster.ok, class))
```

Check that the `Assessment` fields are unique:

```{r}
peek <- function(star) star$Metadata$Assessment
assessment <- sapply(cluster.ok, peek)
cbind(assessment)
any(duplicated(assessment))
```
